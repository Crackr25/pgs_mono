# PROJECT CONTEXT - PINOY GLOBAL SUPPLY B2B PLATFORM

## System Architecture
- **Monorepo Structure**: `/packages/frontend/` (Next.js) + `/packages/backend/` (Laravel)
- **Local Development**:
  - Frontend: http://localhost:3000
  - Backend API: http://localhost:8000
  - Storage: Symlinked at `backend/public/storage`
- **Production (CloudPanel)**:
  - Frontend: https://pinoyglobalsupply.com (Next.js on port 3000, proxied by nginx)
  - Backend API: https://api.pinoyglobalsupply.com (Laravel PHP-FPM)
  - Database: MySQL (espgs)
  - File Storage: Local disk at `/home/pgsapi/htdocs/pgs/packages/backend/storage/app/public/`

## Environment Configuration

### Local (.env)
```env
APP_URL=http://localhost:8000
FILESYSTEM_DISK=local
SANCTUM_STATEFUL_DOMAINS=localhost:3001,127.0.0.1:3001,localhost:3000,127.0.0.1:3000
```

### Production (.env)
```env
APP_URL=https://api.pinoyglobalsupply.com
FILESYSTEM_DISK=local
DB_DATABASE=espgs
APP_ENV=production
APP_DEBUG=false
```

## Image/File Handling Pattern (CRITICAL)

**Current Working Pattern** (from ProductController):
```php
// Upload
$filename = uniqid() . '_' . time() . '.' . $image->getClientOriginalExtension();
$path = $image->storeAs('products', $filename, 'public');
// Result: storage/app/public/products/abc123_1234567890.jpg

// Store in database
ProductImage::create([
    'image_path' => $path,  // Just: "products/abc123_1234567890.jpg"
]);

// Retrieve (in Model accessor)
public function getImageUrlAttribute() {
    return asset('storage/' . $this->image_path);
}
// Local result: http://localhost:8000/storage/products/abc123_1234567890.jpg
// Live result: https://api.pinoyglobalsupply.com/storage/products/abc123_1234567890.jpg
```

**Frontend (Next.js) Image Display**:
```javascript
// In .env.local
NEXT_PUBLIC_API_URL=http://localhost:8000

// In .env.production
NEXT_PUBLIC_API_URL=https://api.pinoyglobalsupply.com

// In components
const imageUrl = `${process.env.NEXT_PUBLIC_API_URL}/storage/${imagePath}`;
```

**RULES**:
1. Always store files using `storeAs($folder, $filename, 'public')` disk
2. Always save only the relative path in database (e.g., `products/image.jpg`)
3. Always use `asset('storage/' . $path)` in Laravel
4. Always use `${NEXT_PUBLIC_API_URL}/storage/${path}` in Next.js
5. Never hardcode domain names in code

## Existing Database Schema

### companies table
```sql
id, user_id*, name, registration (unique), peza_id, location, year_established,
factory_size, product_lines (json), employees, description, website, phone, 
email, logo, verified (boolean), status (enum), timestamps
```

### products table
```sql
id, company_id*, name, specs, image, moq, lead_time, hs_code, variants (json),
price, category, description, active (boolean), stock_quantity, unit, timestamps
```

### product_images table
```sql
id, product_id*, image_path, is_main (boolean), sort_order, alt_text, timestamps
```

### users table (assumed standard Laravel auth)
```sql
id, name, email, email_verified_at, password, remember_token, timestamps
```

## FEATURE REQUEST: Company Storefront Builder (Alibaba-Style)

### Business Requirements
Allow each verified company to create a customizable mini-website showcasing:
- Company branding (logo, colors, banner)
- Product catalog
- Company information
- Contact details
- Custom sections (about, gallery, testimonials)

### Technical Approach: Path-Based URLs
Use route pattern: `pinoyglobalsupply.com/store/{company-slug}`
- No subdomain configuration needed
- Works seamlessly in both local and production
- SEO-friendly slugs
- Example: `pinoyglobalsupply.com/store/acme-manufacturing`

---

## NEW DATABASE TABLES

### 1. company_storefronts
```php
Schema::create('company_storefronts', function (Blueprint $table) {
    $table->id();
    $table->foreignId('company_id')->unique()->constrained()->onDelete('cascade');
    $table->string('slug')->unique()->index();
    $table->foreignId('theme_id')->nullable()->constrained('storefront_themes')->onDelete('set null');
    
    // Branding
    $table->string('banner_image')->nullable();
    $table->string('tagline')->nullable();
    $table->text('about_us')->nullable();
    
    // Styling
    $table->string('primary_color')->default('#FF6600');
    $table->string('secondary_color')->default('#000000');
    $table->string('accent_color')->default('#333333');
    $table->string('font_family')->default('Inter');
    $table->enum('header_layout', ['centered', 'left', 'split'])->default('centered');
    $table->text('custom_css')->nullable();
    
    // SEO
    $table->string('meta_title')->nullable();
    $table->text('meta_description')->nullable();
    $table->string('meta_keywords')->nullable();
    
    // Settings
    $table->boolean('is_active')->default(true);
    $table->boolean('show_contact_form')->default(true);
    $table->boolean('show_products')->default(true);
    $table->json('social_links')->nullable(); // {facebook: '', linkedin: '', etc}
    
    $table->timestamps();
});
```

### 2. storefront_themes
```php
Schema::create('storefront_themes', function (Blueprint $table) {
    $table->id();
    $table->string('name'); // 'Modern', 'Classic', 'Minimal', 'Industrial'
    $table->text('description')->nullable();
    $table->string('preview_image')->nullable();
    $table->text('css_template')->nullable();
    $table->json('layout_config')->nullable(); // Default section arrangements
    $table->json('color_scheme')->nullable(); // Default colors
    $table->boolean('is_active')->default(true);
    $table->integer('sort_order')->default(0);
    $table->timestamps();
});
```

### 3. storefront_sections
```php
Schema::create('storefront_sections', function (Blueprint $table) {
    $table->id();
    $table->foreignId('storefront_id')->constrained('company_storefronts')->onDelete('cascade');
    $table->enum('section_type', [
        'hero', 'products_showcase', 'about', 'contact', 
        'gallery', 'testimonials', 'certifications', 'team', 'video'
    ]);
    $table->string('title')->nullable();
    $table->text('content')->nullable();
    $table->json('images')->nullable(); // Array of image paths
    $table->json('settings')->nullable(); // Type-specific configuration
    $table->integer('sort_order')->default(0);
    $table->boolean('is_visible')->default(true);
    $table->timestamps();
    
    $table->index(['storefront_id', 'sort_order']);
});
```

### 4. storefront_analytics (optional, for future)
```php
Schema::create('storefront_analytics', function (Blueprint $table) {
    $table->id();
    $table->foreignId('storefront_id')->constrained('company_storefronts')->onDelete('cascade');
    $table->date('date');
    $table->integer('views')->default(0);
    $table->integer('unique_visitors')->default(0);
    $table->integer('product_clicks')->default(0);
    $table->integer('contact_submissions')->default(0);
    $table->timestamps();
    
    $table->unique(['storefront_id', 'date']);
});
```

---

## BACKEND IMPLEMENTATION

### Models (in `backend/app/Models/`)

**CompanyStorefront.php**
```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Str;

class CompanyStorefront extends Model
{
    protected $fillable = [
        'company_id', 'slug', 'theme_id', 'banner_image', 'tagline', 'about_us',
        'primary_color', 'secondary_color', 'accent_color', 'font_family', 
        'header_layout', 'custom_css', 'meta_title', 'meta_description', 
        'meta_keywords', 'is_active', 'show_contact_form', 'show_products', 
        'social_links'
    ];

    protected $casts = [
        'is_active' => 'boolean',
        'show_contact_form' => 'boolean',
        'show_products' => 'boolean',
        'social_links' => 'array',
    ];

    public function company()
    {
        return $this->belongsTo(Company::class);
    }

    public function theme()
    {
        return $this->belongsTo(StorefrontTheme::class);
    }

    public function sections()
    {
        return $this->hasMany(StorefrontSection::class, 'storefront_id')->orderBy('sort_order');
    }

    public function getStorefrontUrlAttribute()
    {
        return url("/store/{$this->slug}");
    }

    public function getBannerUrlAttribute()
    {
        return $this->banner_image ? asset('storage/' . $this->banner_image) : null;
    }

    public static function generateUniqueSlug($companyName)
    {
        $slug = Str::slug($companyName);
        $originalSlug = $slug;
        $count = 1;

        while (self::where('slug', $slug)->exists()) {
            $slug = $originalSlug . '-' . $count;
            $count++;
        }

        return $slug;
    }
}
```

**StorefrontTheme.php**
```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class StorefrontTheme extends Model
{
    protected $fillable = [
        'name', 'description', 'preview_image', 'css_template', 
        'layout_config', 'color_scheme', 'is_active', 'sort_order'
    ];

    protected $casts = [
        'is_active' => 'boolean',
        'layout_config' => 'array',
        'color_scheme' => 'array',
    ];

    public function storefronts()
    {
        return $this->hasMany(CompanyStorefront::class, 'theme_id');
    }

    public function getPreviewUrlAttribute()
    {
        return $this->preview_image ? asset('storage/' . $this->preview_image) : null;
    }
}
```

**StorefrontSection.php**
```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class StorefrontSection extends Model
{
    protected $fillable = [
        'storefront_id', 'section_type', 'title', 'content', 
        'images', 'settings', 'sort_order', 'is_visible'
    ];

    protected $casts = [
        'is_visible' => 'boolean',
        'images' => 'array',
        'settings' => 'array',
    ];

    public function storefront()
    {
        return $this->belongsTo(CompanyStorefront::class, 'storefront_id');
    }

    public function getImageUrlsAttribute()
    {
        if (!$this->images) return [];
        
        return array_map(function($path) {
            return asset('storage/' . $path);
        }, $this->images);
    }
}
```

**Update Company.php** (add relationship):
```php
public function storefront()
{
    return $this->hasOne(CompanyStorefront::class);
}
```

### Controllers (in `backend/app/Http/Controllers/Api/`)

**StorefrontController.php** (Authenticated - company manages their storefront)
```php
<?php
namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\Company;
use App\Models\CompanyStorefront;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Storage;

class StorefrontController extends Controller
{
    public function index(Request $request)
    {
        // Get the authenticated user's company
        $company = Company::where('user_id', auth()->id())->first();
        
        if (!$company) {
            return response()->json(['message' => 'No company found for this user'], 404);
        }

        $storefront = $company->storefront()->with(['theme', 'sections'])->first();

        return response()->json($storefront);
    }

    public function store(Request $request)
    {
        $company = Company::where('user_id', auth()->id())->first();
        
        if (!$company) {
            return response()->json(['message' => 'No company found'], 404);
        }

        if ($company->storefront) {
            return response()->json(['message' => 'Storefront already exists'], 409);
        }

        $validated = $request->validate([
            'theme_id' => 'nullable|exists:storefront_themes,id',
            'tagline' => 'nullable|string|max:255',
            'about_us' => 'nullable|string',
            'primary_color' => 'nullable|string|max:7',
            'secondary_color' => 'nullable|string|max:7',
        ]);

        $validated['company_id'] = $company->id;
        $validated['slug'] = CompanyStorefront::generateUniqueSlug($company->name);

        $storefront = CompanyStorefront::create($validated);

        return response()->json($storefront->load(['theme', 'sections']), 201);
    }

    public function update(Request $request, $id)
    {
        $storefront = CompanyStorefront::findOrFail($id);
        
        // Authorization check
        if ($storefront->company->user_id !== auth()->id()) {
            return response()->json(['message' => 'Unauthorized'], 403);
        }

        $validated = $request->validate([
            'theme_id' => 'nullable|exists:storefront_themes,id',
            'tagline' => 'nullable|string|max:255',
            'about_us' => 'nullable|string',
            'primary_color' => 'nullable|string|max:7',
            'secondary_color' => 'nullable|string|max:7',
            'accent_color' => 'nullable|string|max:7',
            'font_family' => 'nullable|string',
            'header_layout' => 'nullable|in:centered,left,split',
            'custom_css' => 'nullable|string',
            'meta_title' => 'nullable|string|max:60',
            'meta_description' => 'nullable|string|max:160',
            'is_active' => 'nullable|boolean',
            'show_contact_form' => 'nullable|boolean',
            'show_products' => 'nullable|boolean',
            'social_links' => 'nullable|array',
        ]);

        $storefront->update($validated);

        return response()->json($storefront->load(['theme', 'sections']));
    }

    public function uploadBanner(Request $request, $id)
    {
        $storefront = CompanyStorefront::findOrFail($id);
        
        if ($storefront->company->user_id !== auth()->id()) {
            return response()->json(['message' => 'Unauthorized'], 403);
        }

        $request->validate([
            'banner' => 'required|image|mimes:jpeg,png,jpg,webp|max:5120', // 5MB max
        ]);

        // Delete old banner if exists
        if ($storefront->banner_image) {
            Storage::disk('public')->delete($storefront->banner_image);
        }

        $file = $request->file('banner');
        $filename = 'banner_' . $storefront->id . '_' . time() . '.' . $file->getClientOriginalExtension();
        $path = $file->storeAs('storefronts/banners', $filename, 'public');

        $storefront->update(['banner_image' => $path]);

        return response()->json([
            'message' => 'Banner uploaded successfully',
            'banner_url' => asset('storage/' . $path)
        ]);
    }

    public function destroy($id)
    {
        $storefront = CompanyStorefront::findOrFail($id);
        
        if ($storefront->company->user_id !== auth()->id()) {
            return response()->json(['message' => 'Unauthorized'], 403);
        }

        // Delete banner image
        if ($storefront->banner_image) {
            Storage::disk('public')->delete($storefront->banner_image);
        }

        $storefront->delete();

        return response()->json(['message' => 'Storefront deleted successfully']);
    }
}
```

**PublicStorefrontController.php** (No auth - public view)
```php
<?php
namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\CompanyStorefront;

class PublicStorefrontController extends Controller
{
    public function show($slug)
    {
        $storefront = CompanyStorefront::where('slug', $slug)
            ->where('is_active', true)
            ->with([
                'company.products' => function($query) {
                    $query->where('active', true)->with('images');
                },
                'company.user',
                'theme',
                'sections' => function($query) {
                    $query->where('is_visible', true)->orderBy('sort_order');
                }
            ])
            ->firstOrFail();

        return response()->json($storefront);
    }
}
```

**StorefrontSectionController.php**
```php
<?php
namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\StorefrontSection;
use App\Models\CompanyStorefront;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Storage;

class StorefrontSectionController extends Controller
{
    public function store(Request $request)
    {
        $validated = $request->validate([
            'storefront_id' => 'required|exists:company_storefronts,id',
            'section_type' => 'required|in:hero,products_showcase,about,contact,gallery,testimonials,certifications,team,video',
            'title' => 'nullable|string|max:255',
            'content' => 'nullable|string',
            'settings' => 'nullable|array',
            'sort_order' => 'nullable|integer',
            'is_visible' => 'nullable|boolean',
        ]);

        // Authorization check
        $storefront = CompanyStorefront::findOrFail($validated['storefront_id']);
        if ($storefront->company->user_id !== auth()->id()) {
            return response()->json(['message' => 'Unauthorized'], 403);
        }

        // Handle image uploads if present
        if ($request->hasFile('images')) {
            $images = [];
            foreach ($request->file('images') as $image) {
                $filename = uniqid() . '_' . time() . '.' . $image->getClientOriginalExtension();
                $path = $image->storeAs('storefronts/sections', $filename, 'public');
                $images[] = $path;
            }
            $validated['images'] = $images;
        }

        $section = StorefrontSection::create($validated);

        return response()->json($section, 201);
    }

    public function update(Request $request, $id)
    {
        $section = StorefrontSection::findOrFail($id);
        
        // Authorization check
        if ($section->storefront->company->user_id !== auth()->id()) {
            return response()->json(['message' => 'Unauthorized'], 403);
        }

        $validated = $request->validate([
            'section_type' => 'sometimes|in:hero,products_showcase,about,contact,gallery,testimonials,certifications,team,video',
            'title' => 'nullable|string|max:255',
            'content' => 'nullable|string',
            'settings' => 'nullable|array',
            'sort_order' => 'nullable|integer',
            'is_visible' => 'nullable|boolean',
        ]);

        // Handle new image uploads
        if ($request->hasFile('images')) {
            // Delete old images
            if ($section->images) {
                foreach ($section->images as $oldImage) {
                    Storage::disk('public')->delete($oldImage);
                }
            }

            $images = [];
            foreach ($request->file('images') as $image) {
                $filename = uniqid() . '_' . time() . '.' . $image->getClientOriginalExtension();
                $path = $image->storeAs('storefronts/sections', $filename, 'public');
                $images[] = $path;
            }
            $validated['images'] = $images;
        }

        $section->update($validated);

        return response()->json($section);
    }

    public function destroy($id)
    {
        $section = StorefrontSection::findOrFail($id);
        
        if ($section->storefront->company->user_id !== auth()->id()) {
            return response()->json(['message' => 'Unauthorized'], 403);
        }

        // Delete associated images
        if ($section->images) {
            foreach ($section->images as $image) {
                Storage::disk('public')->delete($image);
            }
        }

        $section->delete();

        return response()->json(['message' => 'Section deleted successfully']);
    }
}
```

**StorefrontThemeController.php**
```php
<?php
namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\StorefrontTheme;

class StorefrontThemeController extends Controller
{
    public function index()
    {
        $themes = StorefrontTheme::where('is_active', true)
            ->orderBy('sort_order')
            ->get();

        return response()->json($themes);
    }

    public function show($id)
    {
        $theme = StorefrontTheme::findOrFail($id);
        return response()->json($theme);
    }
}
```

### API Routes (in `backend/routes/api.php`)

Add these routes:
```php
// Protected storefront management routes
Route::middleware('auth:sanctum')->group(function () {
    Route::get('storefronts', [StorefrontController::class, 'index']);
    Route::post('storefronts', [StorefrontController::class, 'store']);
    Route::put('storefronts/{id}', [StorefrontController::class, 'update']);
    Route::delete('storefronts/{id}', [StorefrontController::class, 'destroy']);
    Route::post('storefronts/{id}/upload-banner', [StorefrontController::class, 'uploadBanner']);
    
    Route::apiResource('storefront-sections', StorefrontSectionController::class)->except(['index', 'show']);
    
    Route::get('storefront-themes', [StorefrontThemeController::class, 'index']);
    Route::get('storefront-themes/{id}', [StorefrontThemeController::class, 'show']);
});

// Public storefront view (no auth required)
Route::get('public/storefront/{slug}', [PublicStorefrontController::class, 'show']);
```

---

## FRONTEND IMPLEMENTATION

### API Service (in `frontend/lib/api.js` or create `frontend/lib/storefront-api.js`)
```javascript
import axios from 'axios';

const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

const api = axios.create({
  baseURL: `${API_URL}/api`,
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  },
  withCredentials: true,
});

// Add auth token interceptor
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Storefront API functions
export const storefrontAPI = {
  // Get user's storefront
  getMyStorefront: () => api.get('/storefronts'),
  
  // Create storefront
  createStorefront: (data) => api.post('/storefronts', data),
  
  // Update storefront
  updateStorefront: (id, data) => api.put(`/storefronts/${id}`, data),
  
  // Upload banner
  uploadBanner: (id, file) => {
    const formData = new FormData();
    formData.append('banner', file);
    return api.post(`/storefronts/${id}/upload-banner`, formData, {
      headers: { 'Content-Type': 'multipart/form-data' },
    });
  },
  
  // Delete storefront
  deleteStorefront: (id) => api.delete(`/storefronts/${id}`),
  
  // Sections
  createSection: (data, images = []) => {
    const formData = new FormData();
    Object.keys(data).forEach(key => {
      if (key !== 'images') {
        formData.append(key, typeof data[key] === 'object' ? JSON.stringify(data[key]) : data[key]);
      }
    });
    images.forEach(image => formData.append('images[]', image));
    return api.post('/storefront-sections', formData, {
      headers: { 'Content-Type': 'multipart/form-data' },
    });
  },
  
  updateSection: (id, data, images = []) => {
    const formData = new FormData();
    Object.keys(data).forEach(key => {
      if (key !== 'images') {
        formData.append(key, typeof data[key] === 'object' ? JSON.stringify(data[key]) : data[key]);
      }
    });
    images.forEach(image => formData.append('images[]', image));
    return api.put(`/storefront-sections/${id}`, formData, {
      headers: { 'Content-Type': 'multipart/form-data' },
    });
  },
  
  deleteSection: (id) => api.delete(`/storefront-sections/${id}`),
  
  // Themes
  getThemes: () => api.get('/storefront-themes'),
  
  // Public view (no auth)
  getPublicStorefront: (slug) => api.get(`/public/storefront/${slug}`),
};

// Helper function to get full image URL
export const getImageUrl = (path) => {
  if (!path) return null;
  if (path.startsWith('http')) return path;
  return `${API_URL}/storage/${path}`;
};
```

### Public Storefront Page (in `frontend/pages/store/[slug].js`)
```javascript
import { useRouter } from 'next/router';
import { useEffect, useState } from 'react';
import { storefrontAPI, getImageUrl } from '../../lib/storefront-api';
import Head from 'next/head';

export default function PublicStorefront() {
  const router = useRouter();
  const { slug } = router.query;
  const [storefront, setStorefront] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    if (!slug) return;

    const fetchStorefront = async () => {
      try {
        setLoading(true);
        const response = await storefrontAPI.getPublicStorefront(slug);
        setStorefront(response.data);
      } catch (err) {
        setError(err.response?.data?.message || 'Storefront not found');
      } finally {
        setLoading(false);
      }
    };

    fetchStorefront();
  }, [slug]);

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-xl">Loading storefront...</div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <h1 className="text-2xl font-bold text-red-600 mb-2">Error</h1>
          <p>{error}</p>
        </div>
      </div>
    );
  }

  if (!storefront) return null;

  const { company, sections, primary_color, secondary_color, banner_image, tagline } = storefront;

  return (
    <>
      <Head>
        <title>{storefront.meta_title || `${company.name} - Pinoy Global Supply`}</title>
        <meta name="description" content={storefront.meta_description || company.description} />
      </Head>

      <div className="min-h-screen bg-gray-50">
        {/* Header */}
        <header 
          className="bg-white shadow-sm sticky top-0 z-50"
          style={{ borderBottom: `3px solid ${primary_color}` }}
        >
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center space-x-4">
                {company.logo && (
                  <img 
                    src={getImageUrl(company.logo)} 
                    alt={company.name}
                    className="h-12 w-auto"
                  />
                )}
                <div>
                  <h1 className="text-2xl font-bold text-gray-900">{company.name}</h1>
                  {tagline && <p className="text-sm text-gray-600">{tagline}</p>}
                </div>
              </div>
              <nav className="hidden md:flex space-x-6">
                <a href="#about" className="text-gray-700 hover:text-gray-900">About</a>
                <a href="#products" className="text-gray-700 hover:text-gray-900">Products</a>
                <a href="#contact" className="text-gray-700 hover:text-gray-900">Contact</a>
              </nav>
            </div>
          </div>
        </header>

        {/* Banner */}
        {banner_image && (
          <div 
            className="h-96 bg-cover bg-center relative"
            style={{ backgroundImage: `url(${getImageUrl(banner_image)})` }}
          >
            <div className="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center">
              {tagline && (
                <h2 className="text-4xl md:text-5xl font-bold text-white text-center px-4">
                  {tagline}
                </h2>
              )}
            </div>
          </div>
        )}

        {/* Sections */}
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
          {sections.map((section) => (
            <StorefrontSection 
              key={section.id} 
              section={section}
              primaryColor={primary_color}
            />
          ))}

          {/* Products Section */}
          {storefront.show_products && company.products && company.products.length > 0 && (
            <section id="products" className="mb-16">
              <h2 className="text-3xl font-bold mb-8">Our Products</h2>
              <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                {company.products.map((product) => (
                  <div key={product.id} className="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition">
                    {product.main_image && (
                      <img 
                        src={getImageUrl(product.main_image.image_path)}
                        alt={product.name}
                        className="w-full h-48 object-cover"
                      />
                    )}
                    <div className="p-4">
                      <h3 className="font-semibold text-lg mb-2">{product.name}</h3>
                      <p className="text-gray-600 text-sm mb-2 line-clamp-2">{product.description}</p>
                      <div className="flex justify-between items-center">
                        <span className="text-2xl font-bold" style={{ color: primary_color }}>
                          ${product.price}
                        </span>
                        <button 
                          className="px-4 py-2 rounded text-white text-sm"
                          style={{ backgroundColor: primary_color }}
                        >
                          View Details
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </section>
          )}

          {/* Contact Section */}
          <section id="contact" className="bg-white rounded-lg shadow-md p-8">
            <h2 className="text-3xl font-bold mb-6">Contact Us</h2>
            <div className="grid md:grid-cols-2 gap-8">
              <div>
                <h3 className="font-semibold mb-4">Company Information</h3>
                <div className="space-y-2 text-gray-700">
                  {company.phone && <p><strong>Phone:</strong> {company.phone}</p>}
                  {company.email && <p><strong>Email:</strong> {company.email}</p>}
                  {company.location && <p><strong>Location:</strong> {company.location}</p>}
                  {company.website && (
                    <p><strong>Website:</strong> <a href={company.website} target="_blank" className="text-blue-600 hover:underline">{company.website}</a></p>
                  )}
                </div>
              </div>
              {storefront.show_contact_form && (
                <div>
                  <h3 className="font-semibold mb-4">Send a Message</h3>
                  <form className="space-y-4">
                    <input 
                      type="text" 
                      placeholder="Your Name"
                      className="w-full px-4 py-2 border rounded focus:ring-2 focus:ring-opacity-50"
                      style={{ focusRingColor: primary_color }}
                    />
                    <input 
                      type="email" 
                      placeholder="Your Email"
                      className="w-full px-4 py-2 border rounded"
                    />
                    <textarea 
                      placeholder="Your Message"
                      rows="4"
                      className="w-full px-4 py-2 border rounded"
                    ></textarea>
                    <button 
                      type="submit"
                      className="px-6 py-3 rounded text-white font-semibold"
                      style={{ backgroundColor: primary_color }}
                    >
                      Send Message
                    </button>
                  </form>
                </div>
              )}
            </div>
          </section>
        </div>

        {/* Footer */}
        <footer className="bg-gray-800 text-white py-8 mt-16">
          <div className="max-w-7xl mx-auto px-4 text-center">
            <p>&copy; {new Date().getFullYear()} {company.name}. All rights reserved.</p>
            <p className="text-sm text-gray-400 mt-2">Powered by Pinoy Global Supply</p>
          </div>
        </footer>
      </div>
    </>
  );
}

// Component to render different section types
function StorefrontSection({ section, primaryColor }) {
  const { section_type, title, content, images } = section;

  if (section_type === 'about') {
    return (
      <section id="about" className="mb-16">
        <h2 className="text-3xl font-bold mb-6">{title || 'About Us'}</h2>
        <div className="bg-white rounded-lg shadow-md p-8">
          <p className="text-gray-700 whitespace-pre-wrap leading-relaxed">{content}</p>
        </div>
      </section>
    );
  }

  if (section_type === 'gallery' && images && images.length > 0) {
    return (
      <section className="mb-16">
        <h2 className="text-3xl font-bold mb-6">{title || 'Gallery'}</h2>
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          {images.map((img, idx) => (
            <img 
              key={idx}
              src={getImageUrl(img)}
              alt={`Gallery image ${idx + 1}`}
              className="w-full h-64 object-cover rounded-lg shadow-md hover:shadow-xl transition"
            />
          ))}
        </div>
      </section>
    );
  }

  // Add more section types as needed
  return null;
}
```

### Storefront Builder Dashboard (in `frontend/pages/dashboard/storefront/index.js`)
```javascript
import { useState, useEffect } from 'react';
import { storefrontAPI, getImageUrl } from '../../../lib/storefront-api';
import { useRouter } from 'next/router';

export default function StorefrontBuilder() {
  const router = useRouter();
  const [storefront, setStorefront] = useState(null);
  const [loading, setLoading] = useState(true);
  const [themes, setThemes] = useState([]);
  const [formData, setFormData] = useState({
    tagline: '',
    about_us: '',
    primary_color: '#FF6600',
    secondary_color: '#000000',
    theme_id: null,
  });

  useEffect(() => {
    fetchStorefront();
    fetchThemes();
  }, []);

  const fetchStorefront = async () => {
    try {
      const response = await storefrontAPI.getMyStorefront();
      if (response.data) {
        setStorefront(response.data);
        setFormData({
          tagline: response.data.tagline || '',
          about_us: response.data.about_us || '',
          primary_color: response.data.primary_color,
          secondary_color: response.data.secondary_color,
          theme_id: response.data.theme_id,
        });
      }
    } catch (error) {
      console.error('Error fetching storefront:', error);
    } finally {
      setLoading(false);
    }
  };

  const fetchThemes = async () => {
    try {
      const response = await storefrontAPI.getThemes();
      setThemes(response.data);
    } catch (error) {
      console.error('Error fetching themes:', error);
    }
  };

  const handleCreate = async () => {
    try {
      const response = await storefrontAPI.createStorefront(formData);
      setStorefront(response.data);
      alert('Storefront created successfully!');
    } catch (error) {
      alert('Error creating storefront: ' + error.response?.data?.message);
    }
  };

  const handleUpdate = async () => {
    try {
      const response = await storefrontAPI.updateStorefront(storefront.id, formData);
      setStorefront(response.data);
      alert('Storefront updated successfully!');
    } catch (error) {
      alert('Error updating storefront: ' + error.response?.data?.message);
    }
  };

  const handleBannerUpload = async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    try {
      const response = await storefrontAPI.uploadBanner(storefront.id, file);
      alert('Banner uploaded successfully!');
      fetchStorefront(); // Refresh
    } catch (error) {
      alert('Error uploading banner: ' + error.response?.data?.message);
    }
  };

  if (loading) {
    return <div className="p-8">Loading...</div>;
  }

  return (
    <div className="max-w-4xl mx-auto p-8">
      <h1 className="text-3xl font-bold mb-8">Storefront Builder</h1>

      {!storefront ? (
        <div className="bg-white rounded-lg shadow-md p-8">
          <h2 className="text-xl font-semibold mb-4">Create Your Storefront</h2>
          <p className="text-gray-600 mb-6">Set up your company's custom storefront to showcase your products and brand.</p>
          
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-2">Tagline</label>
              <input 
                type="text"
                className="w-full px-4 py-2 border rounded"
                value={formData.tagline}
                onChange={(e) => setFormData({...formData, tagline: e.target.value})}
                placeholder="Your company's tagline"
              />
            </div>

            <div>
              <label className="block text-sm font-medium mb-2">About Us</label>
              <textarea 
                className="w-full px-4 py-2 border rounded"
                rows="4"
                value={formData.about_us}
                onChange={(e) => setFormData({...formData, about_us: e.target.value})}
                placeholder="Tell customers about your company"
              />
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-2">Primary Color</label>
                <input 
                  type="color"
                  className="w-full h-12 border rounded"
                  value={formData.primary_color}
                  onChange={(e) => setFormData({...formData, primary_color: e.target.value})}
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-2">Secondary Color</label>
                <input 
                  type="color"
                  className="w-full h-12 border rounded"
                  value={formData.secondary_color}
                  onChange={(e) => setFormData({...formData, secondary_color: e.target.value})}
                />
              </div>
            </div>

            <button 
              onClick={handleCreate}
              className="w-full bg-blue-600 text-white py-3 rounded font-semibold hover:bg-blue-700"
            >
              Create Storefront
            </button>
          </div>
        </div>
      ) : (
        <div className="space-y-6">
          {/* Storefront URL */}
          <div className="bg-green-50 border border-green-200 rounded-lg p-4">
            <p className="text-sm text-gray-700 mb-2">Your storefront is live at:</p>
            <a 
              href={`/store/${storefront.slug}`}
              target="_blank"
              className="text-lg font-semibold text-blue-600 hover:underline"
            >
              {window.location.origin}/store/{storefront.slug}
            </a>
          </div>

          {/* Banner Upload */}
          <div className="bg-white rounded-lg shadow-md p-6">
            <h3 className="text-lg font-semibold mb-4">Banner Image</h3>
            {storefront.banner_image && (
              <img 
                src={getImageUrl(storefront.banner_image)}
                alt="Banner"
                className="w-full h-48 object-cover rounded mb-4"
              />
            )}
            <input 
              type="file"
              accept="image/*"
              onChange={handleBannerUpload}
              className="w-full"
            />
          </div>

          {/* Edit Form */}
          <div className="bg-white rounded-lg shadow-md p-6">
            <h3 className="text-lg font-semibold mb-4">Storefront Settings</h3>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-2">Tagline</label>
                <input 
                  type="text"
                  className="w-full px-4 py-2 border rounded"
                  value={formData.tagline}
                  onChange={(e) => setFormData({...formData, tagline: e.target.value})}
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">About Us</label>
                <textarea 
                  className="w-full px-4 py-2 border rounded"
                  rows="4"
                  value={formData.about_us}
                  onChange={(e) => setFormData({...formData, about_us: e.target.value})}
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium mb-2">Primary Color</label>
                  <input 
                    type="color"
                    className="w-full h-12 border rounded"
                    value={formData.primary_color}
                    onChange={(e) => setFormData({...formData, primary_color: e.target.value})}
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-2">Secondary Color</label>
                  <input 
                    type="color"
                    className="w-full h-12 border rounded"
                    value={formData.secondary_color}
                    onChange={(e) => setFormData({...formData, secondary_color: e.target.value})}
                  />
                </div>
              </div>

              <button 
                onClick={handleUpdate}
                className="w-full bg-blue-600 text-white py-3 rounded font-semibold hover:bg-blue-700"
              >
                Save Changes
              </button>
            </div>
          </div>

          {/* Sections Management */}
          <div className="bg-white rounded-lg shadow-md p-6">
            <h3 className="text-lg font-semibold mb-4">Page Sections</h3>
            <p className="text-gray-600 mb-4">Add custom sections to your storefront.</p>
            <button 
              onClick={() => router.push('/dashboard/storefront/sections')}
              className="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700"
            >
              Manage Sections
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
```

---

## SEEDER (in `backend/database/seeders/StorefrontSeeder.php`)
```php
<?php
namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\StorefrontTheme;

class StorefrontSeeder extends Seeder
{
    public function run()
    {
        // Create themes
        $themes = [
            [
                'name' => 'Modern',
                'description' => 'Clean, contemporary design with bold typography',
                'color_scheme' => [
                    'primary' => '#3B82F6',
                    'secondary' => '#1E293B',
                    'accent' => '#F59E0B',
                ],
                'layout_config' => [
                    'header_style' => 'centered',
                    'section_spacing' => 'large',
                ],
                'sort_order' => 1,
            ],
            [
                'name' => 'Classic',
                'description' => 'Traditional, professional layout',
                'color_scheme' => [
                    'primary' => '#1F2937',
                    'secondary' => '#6B7280',
                    'accent' => '#DC2626',
                ],
                'layout_config' => [
                    'header_style' => 'left',
                    'section_spacing' => 'medium',
                ],
                'sort_order' => 2,
            ],
            [
                'name' => 'Minimal',
                'description' => 'Simple, elegant design with lots of whitespace',
                'color_scheme' => [
                    'primary' => '#000000',
                    'secondary' => '#6B7280',
                    'accent' => '#10B981',
                ],
                'layout_config' => [
                    'header_style' => 'centered',
                    'section_spacing' => 'extra-large',
                ],
                'sort_order' => 3,
            ],
        ];

        foreach ($themes as $theme) {
            StorefrontTheme::create($theme);
        }

        $this->command->info('Storefront themes seeded successfully!');
    }
}
```

---

## DEPLOYMENT CHECKLIST

### Local Testing
1. Run migrations: `php artisan migrate`
2. Run seeder: `php artisan db:seed --class=StorefrontSeeder`
3. Test API endpoints with Postman
4. Test Next.js pages locally
5. Verify image uploads work

### Production Deployment
1. **Backend**:
```bash
   cd /home/pgsapi/htdocs/pgs/packages/backend
   php artisan migrate --force
   php artisan db:seed --class=StorefrontSeeder --force
   php artisan config:clear
   php artisan cache:clear
```

2. **Frontend**:
```bash
   cd /home/pinoyglobalsupply/htdocs/pgs/packages/frontend
   npm run build
   pm2 restart pgs-frontend
```

3. **Verify**:
   - Test API: `https://api.pinoyglobalsupply.com/api/storefront-themes`
   - Test frontend: `https://pinoyglobalsupply.com/dashboard/storefront`
   - Test public view: Create a storefront and visit `/store/{slug}`

---

## CRITICAL RULES FOR COPILOT

1. **DO NOT modify existing migrations** - only create new ones
2. **DO NOT delete existing code** - only add new features
3. **Follow existing patterns** exactly (controller structure, validation, responses)
4. **Always use `asset('storage/' . $path)`** for images in Laravel
5. **Always use `${NEXT_PUBLIC_API_URL}/storage/${path}`** in Next.js
6. **Test each phase** before moving to the next
7. **Add comments** explaining complex logic
8. **Handle errors gracefully** with try-catch blocks

---

## START HERE

Begin with Phase 1: Create the three migration files following the existing migration patterns in `backend/database/migrations/`. Show me the files for review before proceeding.